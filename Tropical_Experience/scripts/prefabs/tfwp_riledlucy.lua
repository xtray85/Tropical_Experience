local a={Asset("ANIM","anim/swap_lucy_axe.zip"),Asset("ANIM","anim/lavaarena_lucy.zip"),Asset("INV_IMAGE","lucy")}local b={Asset("ANIM","anim/lavaarena_lucy.zip")}local c={Asset("ANIM","anim/splash_ocean.zip")}local d={"reticulelong","reticulelongping","weaponsparks_fx","lucy_transform_fx","lucy_ground_transform_fx","splash_lavafx","lucyspin_fx","lucy_classified"}local function e(f,g)f.lucy_classified=g;f.ondetachclassified=function()f:DetachClassified()end;f:ListenForEvent("onremove",f.ondetachclassified,g)end;local function h(f)f.lucy_classified=nil;f.ondetachclassified=nil end;local function i(f)if f.lucy_classified~=nil then if TheWorld.ismastersim then f.lucy_classified:Remove()f.lucy_classified=nil else f.lucy_classified._parent=nil;f:RemoveEventCallback("onremove",f.ondetachclassified,f.lucy_classified)f:DetachClassified()end end end;local function j(f)if f._container~=nil then f:RemoveEventCallback("onputininventory",f._oncontainerownerchanged,f._container)f:RemoveEventCallback("ondropped",f._oncontainerownerchanged,f._container)f:RemoveEventCallback("onremove",f._oncontainerremoved,f._container)f._container=nil end end;local function k(f,l)if l~=nil and l.components.container~=nil then f:ListenForEvent("onputininventory",f._oncontainerownerchanged,l)f:ListenForEvent("ondropped",f._oncontainerownerchanged,l)f:ListenForEvent("onremove",f._oncontainerremoved,l)f._container=l end end;local function m(f,n)if f._container~=n then j(f)k(f,n)end;f.lucy_classified:SetTarget(n.components.inventoryitem~=nil and n.components.inventoryitem.owner or n)end;local function o(f)j(f)f.lucy_classified:SetTarget(nil)end;local function p(f)f.localsounds.SoundEmitter:KillSound("talk")end;local function q(f)local r=f.lucy_classified~=nil and f.lucy_classified:GetTalkSound()or nil;if r~=nil then f.localsounds.SoundEmitter:KillSound("talk")f.localsounds.SoundEmitter:PlaySound(r)elseif not f.localsounds.SoundEmitter:PlayingSound("talk")then f.localsounds.SoundEmitter:PlaySound("dontstarve/characters/woodie/lucytalk_LP","talk")end end;local function s(f)if f.components.sentientaxe~=nil then f.components.sentientaxe:Say(STRINGS.LUCY.on_haunt)return true end;return false end;local function t(f,n)n.AnimState:OverrideSymbol("swap_object","swap_lucy_axe","swap_lucy_axe")n.AnimState:Show("ARM_carry")n.AnimState:Hide("ARM_normal")end;local function u(f,n)n.AnimState:Hide("ARM_carry")n.AnimState:Show("ARM_normal")end;local function v()return Vector3(ThePlayer.entity:LocalToWorldSpace(6.5,0,0))end;local function w(f,x)if x~=nil then local y,z,A=f.Transform:GetWorldPosition()local B=x.x-y;local C=x.z-A;local D=B*B+C*C;if D<=0 then return f.components.reticule.targetpos end;D=6.5/math.sqrt(D)return Vector3(y+B*D,0,A+C*D)end end;local function E(f,F,G,H,I,J)local y,z,A=f.Transform:GetWorldPosition()G.Transform:SetPosition(y,0,A)local K=-math.atan2(F.z-A,F.x-y)/DEGREES;if H and J~=nil then local L=G.Transform:GetRotation()local M=K-L;K=Lerp(M>180 and L+360 or M<-180 and L-360 or L,K,J*I)end;G.Transform:SetRotation(K)end;local function N(f,O,F)f.components.aimedprojectile:Throw(f,O,F)end;local function P(f)f:RemoveTag("NOCLICK")f.ismoving=false;f.Physics:Stop()f.Physics:SetCollisionGroup(COLLISION.OBSTACLES)f.Physics:CollidesWith(COLLISION.WORLD)f.Physics:CollidesWith(COLLISION.OBSTACLES)f.Physics:CollidesWith(COLLISION.SMALLOBSTACLES)f.components.inventoryitem.canbepickedup=true;f.AnimState:SetMultColour(1,1,1,1)end;local function Q(f,R,S)R.components.combat.ignorehitrange=false;if not S then f.Physics:SetMotorVel(5,0,0)end;f:DoTaskInTime(FRAMES*15,function()if S and not f:IsOnValidGround()or f:IsOnValidGround()then if R and R.prefab=="woodie"then f.Physics:Stop()f.AnimState:SetMultColour(0,0,0,0)f.returnfrompos=f:GetPosition()if not S then SpawnPrefab("lucy_transform_fx").Transform:SetPosition(f:GetPosition():Get())end;f.projectileowner=nil;f:DoTaskInTime(FRAMES*12,function()if S and not f:IsOnValidGround()or f:IsOnValidGround()then if R and R.entity and R.entity:IsValid()and R.entity:IsVisible()then if R.sg:HasStateTag("idle")then f.projectileowner=R end;R.components.inventory:Equip(f)R:SpawnChild("lucyspin_fx"):SetOrigin(f.returnfrompos:Get())f.returnfrompos=nil;if not R.sg.statemem.playedfx then SpawnPrefab("lucy_transform_fx").entity:AddFollower():FollowSymbol(R.GUID,"swap_object",50,-25,-1)end else if S then f:DoTaskInTime(2,function(f)f:PutBackOnGround()local F=f:GetPosition()f.Transform:SetPosition(F.x,12,F.z)P(f)end)else SpawnPrefab("lucy_transform_fx").Transform:SetPosition(f:GetPosition():Get())end end;P(f)end end)else if S then f:DoTaskInTime(3,function(f)f:PutBackOnGround()local F=f:GetPosition()f.Transform:SetPosition(F.x,12,F.z)P(f)end)else P(f)end end end end)end;local function T(f,R)f:DoTaskInTime(0,function(f)if not f:IsOnValidGround()then f.ismoving=false;f.Physics:Stop()f.components.aimedprojectile:Stop()f.AnimState:SetMultColour(0,0,0,0)f.AnimState:PlayAnimation("idle")SpawnPrefab("splash_lavafx").Transform:SetPosition(f:GetPosition():Get())Q(f,R,true)end;if f.ismoving then T(f,R)end end)end;local function U(f,n,R,V)R.components.inventory:DropItem(f)f:AddTag("NOCLICK")f.Physics:ClearCollisionMask()f.components.inventoryitem.canbepickedup=false;f.AnimState:PlayAnimation("spin_loop",true)f.ismoving=true;R.components.combat.ignorehitrange=true;T(f,R)end;local function W(f,n,R,X)SpawnPrefab("weaponsparks_fx"):SetPiercing(f,X)f.AnimState:PlayAnimation("bounce")f.AnimState:PushAnimation("idle")if X.components.combat and R~=nil then X.components.combat:SetTarget(R)X.aggrotimer=GetTime()+1 end;f.components.aimedprojectile:RotateToTarget(R:GetPosition())if f:IsOnValidGround()then Q(f,R)end;if X and X:HasTag("tree")and X.components.workable then X.components.workable:WorkedBy(n,TUNING.FORGE_ITEM_PACK.RILEDLUCY.WORKABLE_DMG)end end;local function Y(f,n,R)SpawnPrefab("weaponsparks_fx"):SetBounce(f)f.AnimState:PlayAnimation("bounce")f.AnimState:PushAnimation("idle")if f:IsOnValidGround()then Q(f,R)end end;local function Z(f,R,X)SpawnPrefab("weaponsparks_fx"):SetPosition(R,X)if X.components.sleeper and X.components.sleeper:IsAsleep()then X.components.sleeper:WakeUp()end;if X.components.combat then X.components.combat:SuggestTarget(R)end end;local function _()local f=CreateEntity()f.entity:AddTransform()f.entity:AddAnimState()f.entity:AddMiniMapEntity()f.entity:AddNetwork()MakeInventoryPhysics(f)f.MiniMapEntity:SetIcon("lucy_axe.png")f.nameoverride="lavaarena_lucy"f.AnimState:SetBank("lavaarena_lucy")f.AnimState:SetBuild("lavaarena_lucy")f.AnimState:PlayAnimation("idle")f.Transform:SetSixFaced()f:AddTag("chop_attack")f:AddTag("melee")f:AddTag("rechargeable")f:AddTag("sharp")f:AddTag("throw_line")f.AttachClassified=e;f.DetachClassified=h;f.OnRemoveEntity=i;f:AddComponent("aoetargeting")f.components.aoetargeting:SetAlwaysValid(true)f.components.aoetargeting.reticule.reticuleprefab="reticulelong"f.components.aoetargeting.reticule.pingprefab="reticulelongping"f.components.aoetargeting.reticule.targetfn=v;f.components.aoetargeting.reticule.mousetargetfn=w;f.components.aoetargeting.reticule.updatepositionfn=E;f.components.aoetargeting.reticule.validcolour={1,.75,0,1}f.components.aoetargeting.reticule.invalidcolour={.5,0,0,1}f.components.aoetargeting.reticule.ease=true;f.components.aoetargeting.reticule.mouseenabled=true;f:AddComponent("talker")f.components.talker.fontsize=28;f.components.talker.font=TALKINGFONT;f.components.talker.colour=Vector3(.9,.4,.4)f.components.talker.offset=Vector3(0,0,0)f.components.talker.symbol="swap_object"if not TheNet:IsDedicated()then f.localsounds=CreateEntity()f.localsounds:AddTag("FX")f.localsounds.entity:AddTransform()f.localsounds.entity:AddSoundEmitter()f.localsounds.entity:SetParent(f.entity)f.localsounds:Hide()f.localsounds.persists=false;f:ListenForEvent("ontalk",q)f:ListenForEvent("donetalking",p)end;f.entity:SetPristine()if not TheWorld.ismastersim then return f end;f.IsWorkableAllowed=function(self,a0,a1)return a0==ACTIONS.CHOP end;f.lucy_classified=SpawnPrefab("lucy_classified")f.lucy_classified.entity:SetParent(f.entity)f.lucy_classified._parent=f;f.lucy_classified:SetTarget(nil)f._container=nil;f._oncontainerownerchanged=function(l)m(f,l)end;f._oncontainerremoved=function()j(f)end;f:ListenForEvent("onputininventory",m)f:ListenForEvent("ondropped",o)f:AddComponent("aoespell")f.components.aoespell:SetAOESpell(N)f:AddComponent("aimedprojectile")f.components.aimedprojectile:SetHitDistance(3)f.components.aimedprojectile:SetStimuli("strong")f.components.aimedprojectile:SetOnThrownFn(U)f.components.aimedprojectile:SetOnHitFn(W)f.components.aimedprojectile:SetOnMissFn(Y)f:AddComponent("equippable")f.components.equippable:SetOnEquip(t)f.components.equippable:SetOnUnequip(u)f:AddComponent("inspectable")f:AddComponent("inventoryitem")f.components.inventoryitem.imagename="lucy"f:AddComponent("possessedaxe")f.components.possessedaxe.revert_fx="lucy_ground_transform_fx"f.components.possessedaxe.transform_fx="lucy_transform_fx"f:AddComponent("recarregavel")f:AddComponent("sentientaxe")f:AddComponent("tool")f.components.tool:SetAction(ACTIONS.CHOP,2)f:AddComponent("weapon")f.components.weapon:SetDamage(TUNING.FORGE_ITEM_PACK.RILEDLUCY.DAMAGE)f.components.weapon:SetOnAttack(Z)f.components.weapon:SetDamageType(DAMAGETYPES.PHYSICAL)f.components.weapon:SetAltAttack(TUNING.FORGE_ITEM_PACK.RILEDLUCY.ALT_DAMAGE,10,nil,DAMAGETYPES.PHYSICAL)MakeHauntableLaunch(f)AddHauntableCustomReaction(f,s,true,false,true)return f end;local function a2()local f=CreateEntity()f.entity:AddTransform()f.entity:AddAnimState()f.entity:AddNetwork()f.AnimState:SetMultColour(.5,.5,.5,1)f.AnimState:SetAddColour(1,.7,.2,.9)f.AnimState:SetBank("splash")f.AnimState:SetBuild("splash_ocean")f.AnimState:PlayAnimation("idle")f.entity:SetPristine()if not TheWorld.ismastersim then return f end;f:ListenForEvent("animover",f.Remove)return f end;local function a3()local f=CreateEntity()f:AddTag("FX")f.entity:SetCanSleep(false)f.persists=false;f.entity:AddTransform()f.entity:AddAnimState()f.AnimState:SetBank("lavaarena_lucy")f.AnimState:SetBuild("lavaarena_lucy")f.AnimState:PlayAnimation("return")f.AnimState:SetMultColour(.2,.2,.2,.2)f.Transform:SetSixFaced()f:DoTaskInTime(13*FRAMES,f.Remove)return f end;local function a4(a5,f)local a6=a5.owner.entity:GetParent()if a5.alpha>=.6 and(a6==nil or not(a6.AnimState:IsCurrentAnimation("catch_pre")or a6.AnimState:IsCurrentAnimation("catch")))then a5.dalpha=-.1 end;local y,z,A=f.Transform:GetWorldPosition()local a7,a8,a9=a5.Transform:GetWorldPosition()local B=a7-y;local C=a9-A;local aa=math.sqrt(B*B+C*C)a5.offset=a5.offset*.8+.2;a5.vy=a5.vy+a5.ay;a5.height=a5.height+a5.vy;a5.Transform:SetPosition(y+B*a5.offset/aa,a5.height,A+C*a5.offset/aa)if a5.alpha~=0 then a5.alpha=a5.alpha+a5.dalpha;if a5.alpha>=1 then a5.dalpha=0;a5.alpha=1 elseif a5.alpha<=0 then a5:Remove()end;a5.AnimState:SetMultColour(a5.alpha,a5.alpha,a5.alpha,a5.alpha)end end;local function ab(f)local a6=f.entity:GetParent()if a6~=nil then local y,z,A=f.Transform:GetWorldPosition()local B=f._originx:value()-y;local C=f._originz:value()-A;local ac=B*B+C*C;local aa=math.sqrt(ac)local a5=a3()a5.owner=f;a5.offset=math.min(3,aa)a5.height=2;a5.vy=.2;a5.ay=-.05;a5.alpha=.2;a5.dalpha=.2;a5.Transform:SetPosition(y+B*a5.offset/aa,a5.height,A+C*a5.offset/aa)a5:ForceFacePoint(f._originx:value(),0,f._originz:value())a5:ListenForEvent("onremove",function()a5:Remove()end,f)a5:DoPeriodicTask(0,a4,nil,f)end end;local function ad(f,y,z,A)f._originx:set(y)f._originz:set(A)if not TheNet:IsDedicated()then ab(f)end end;local function ae()local f=CreateEntity()f.entity:AddTransform()f.entity:AddNetwork()f:AddTag("FX")f._originx=net_float(f.GUID,"lavaarena_lucy_spin._originx","origindirty")f._originz=net_float(f.GUID,"lavaarena_lucy_spin._originz","origindirty")f.entity:SetPristine()if not TheWorld.ismastersim then f:ListenForEvent("origindirty",ab)return f end;f.persists=false;f.SetOrigin=ad;f:DoTaskInTime(.5,f.Remove)return f end;return CustomPrefab("riledlucy",_,a,d,nil,"images/inventoryimages.xml","lavaarena_lucy.tex",TUNING.FORGE_ITEM_PACK.RILEDLUCY,"swap_lucy_axe","common_hand"),Prefab("lucyspin_fx",ae,b),Prefab("splash_lavafx",a2,c)